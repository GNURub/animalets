---
import PetManager from '../../components/PetManager';
import AppLayout from '../../layouts/AppLayout.astro';

const { user, profile } = Astro.locals;

if (!user) {
  return Astro.redirect('/signin');
}

// Obtener mascotas del usuario
const { data: pets, error } = await Astro.locals.supabase
  .from('pets')
  .select('*')
  .eq('owner_id', user.id)
  .order('name', { ascending: true });

if (error) {
  console.error('Error al cargar mascotas:', error);
}
---

<AppLayout title='Mis Mascotas'>
  <div class='mx-auto max-w-7xl'>
    <div class='mb-8'>
      <h1 class='mb-2 text-3xl font-bold text-gray-900'>Mis Mascotas</h1>
      <p class='text-gray-600'>
        Gestiona la información de tus compañeros peludos
      </p>
    </div>

    <PetManager client:load initialPets={pets || []} userId={user.id} />
  </div>
</AppLayout>
